#!/sbin/openrc-run
command="/usr/sbin/php-fpm7"
command_args="--nodaemonize"

name="php-fpm"
command_background="yes"
pidfile="/var/run/php-fpm.pid"

depend() {
    need net
    before nginx
}

start_pre() {
    # Проверить, если PHP-FPM уже запущен
    if [ -f "$pidfile" ]; then
        eerror "PHP-FPM already running! (pidfile $pidfile exists)"
        return 1
    fi
}

stop_pre() {
    # Проверить, если PHP-FPM не запущен
    if [ ! -f "$pidfile" ]; then
        eerror "PHP-FPM not running! (pidfile $pidfile does not exist)"
        return 1
    fi
}

reload_pre() {
    # Проверить, если PHP-FPM не запущен
    if [ ! -f "$pidfile" ]; then
        eerror "PHP-FPM not running! (pidfile $pidfile does not exist)"
        return 1
    fi
}

reload() {
    ebegin "Reloading PHP-FPM configuration..."
    start-stop-daemon --signal USR2 --pidfile "$pidfile"
    eend $?
}

extra_started_commands="reload"

